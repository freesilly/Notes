## 重要

结构体里面的变量不能带下划线

### 9.1 unity的渲染路径

**前向渲染路径** (Forward Rendering Path) 、**延迟渲染路径** (Deferred Rendering Path)

#### 9.1.1 前向渲染

每进行一次完整的前向渲染，我们需要渲染该对象的渲染图元，并计算两个缓冲区的信息：一个是颜色缓冲区， 一个是深度缓冲区。我们利用深度缓冲来决定一个片元是否可见，如果可见就更新颜色缓冲区中的颜色值。
伪代码：
![[Pasted image 20250915195813.png]]

Unity 中，前向渲染路径有3种处理光照（即照亮物体）的方式： **逐顶点处理**、**逐像素处理**，**球谐函数** (Spherical Harmonics, SH) 处理。

#### 9.1.3 延迟渲染

**G-buffer (几何缓冲区)** 是延迟渲染技术中使用的一组额外缓冲区。它的核心作用是存储屏幕上可见物体表面的各种几何与材质信息（如位置、法线、颜色等），为之后的光照计算提供所需数据。


延迟渲染将渲染过程分为两个步骤（Pass）：

1. **第一步 (几何阶段)**：不计算光照。只找出屏幕上哪些像素是可见的，并将这些可见像素的几何信息（如法线、颜色等）存入一个缓冲区。
    
2. **第二步 (光照阶段)**：利用第一步存储在缓冲区中的信息，对每个像素进行光照计算，最终生成图像。

**延迟渲染的缺点：** 
• 不支持真正的抗锯齿 (anti-aliasing) 功能。 
• 不能处理半透明物体。

当使用延迟渲染时， Unity 要求我们提供两个 Pass
(1)第一个Pass用于渲染G缓冲。在这个Pass 中，我们会把物体的漫反射颜色、高光反射颜色、平滑度 、法线、自发光和深度等信息渲染到屏幕空间的G缓冲区中。对于每个物体来说， 这个Pass会执行一次。
(2)第二个Pass用于计算真正的光照模型。这个Pass会使用上一 个Pass中渲染的数据来计算最终的光照颜色，再存储到帧缓冲中。


### 9.2 Unity的光源类型

Unity 一共支持4种光源类型：**平行光**、**点光源**、**聚光灯**和**面光源**。




### 9.4 Unity的阴影

为了高效地生成阴影，Unity并没有采用在光源位置完整运行一遍常规渲染流程的低效方法，因为这会包含大量不必要的复杂光照计算。取而代之的是，它设计了一个专门的渲染通道（Pass），即 LightMode = "ShadowCaster" 的**ShadowCaster Pass**。

这个Pass的唯一目的就是，从光源的视角出发，只计算和输出物体的深度信息到一张名为“阴影映射纹理”的特殊纹理上。如果一个物体的Shader中没有定义这个ShadowCaster Pass（或是在其Fallback中也找不到），那么该物体就无法投射阴影。

